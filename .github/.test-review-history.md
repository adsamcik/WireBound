# Test Review History

## Review: 2026-02-21 — Full Test Suite Sweep + Architectural Fixes

### Scope
All tests in `tests/WireBound.Tests/` (65+ test files)

### Commits (in order)
1. `7a0698a` — Replace early-return platform checks with TUnit skip mechanism
2. `a899c09` — Add IUiDispatcher abstraction for testable UI thread dispatching
3. `c54ffb2` — Wire IUiDispatcher into ViewModels replacing Dispatcher.UIThread
4. `570aa18` — Expose InitializationTask for awaitable ViewModel init
5. `3f4f585` — Replace Thread.Sleep with await InitializationTask in ViewModel tests
6. `e530dc1` — Un-skip 6 ConnectionsViewModel tests
7. `e338f31` — Strengthen hollow coverage and add missing aggregation tests
8. `452e522` — Add DataPersistenceService tests for SaveAppStats, adapter usage, cleanup

### Architectural Changes
- **IUiDispatcher**: New interface in WireBound.Core abstracting Dispatcher.UIThread. AvaloniaDispatcher wraps real dispatcher; SynchronousDispatcher for tests executes inline.
- **InitializationTask**: 6 ViewModels now expose public Task property for awaitable async init. Eliminates ~45 Thread.Sleep calls from tests.
- **PlatformSkipAttributes**: WindowsOnlyAttribute/LinuxOnlyAttribute using TUnit SkipAttribute for proper CI reporting.

### Test Improvements
- Deleted 26 no-op event subscription/unsubscription tests
- Fixed 4 tautological assertions
- Rewrote GetTrendStatus test to exercise actual ViewModel code
- Converted 80+ platform guard early-returns to skip attributes
- Added SecretManager secure-wipe verification test
- Added DataPersistenceService counter-reset and full settings round-trip tests
- Added precise MaxMessageSize boundary test pair
- Replaced ~45 Thread.Sleep/Task.Delay with await InitializationTask
- Un-skipped 6 ConnectionsViewModel tests
- Strengthened ChartSeriesFactory from 12 to 24 tests with real assertions
- Added 5 AdaptiveThresholdCalculator asymmetric rate tests
- Added 7 SystemHistoryService aggregation tests
- Added 6 DataPersistenceService gap tests (SaveAppStats, adapter usage, cleanup)

### Oracle Density After
- Overall: ~8.5/10 (up from 6.5 before review)
- Helpers: 9.5/10 (up from 8.8)
- Models: 9.5/10 (unchanged)
- Services: 8.5/10 (up from 7.5)
- ViewModels: 8.0/10 (up from 5.8)
- IPC: 9.0/10 (up from 8.0)

### Remaining Gaps
- HelperServer has zero test coverage (security concern)
- TrayIconService Dispatcher usage not abstracted (requires Avalonia control creation)
- Some SettingsViewModel auto-save tests still use Task.Delay(700) for debounce timer
- 3,367 lines of model tests (deleted in d5fe475) still not fully replaced
- CleanupOldAppDataAsync record removal test skipped (InMemory provider limitation)

