<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WireBound.Avalonia.ViewModels"
             x:Class="WireBound.Avalonia.Views.SettingsView"
             x:DataType="vm:SettingsViewModel"
             Background="{DynamicResource BackgroundBrush}"
             AutomationProperties.Name="Settings View">

    <ScrollViewer Margin="28">
        <StackPanel Spacing="24">
            
            <!-- Header -->
            <StackPanel Spacing="4">
                <TextBlock Text="Settings" Classes="PageTitle" />
                <TextBlock Text="Configure monitoring options" Classes="Subtitle" />
            </StackPanel>

            <!-- Network Settings -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource DownloadBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="ðŸ“¡" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Monitoring Settings" Classes="SectionHeader" />
                            <TextBlock Text="Configure how network data is collected" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Network Adapter -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Network Adapter" Classes="CardTitle" />
                                <TextBlock Text="Select which adapter to monitor" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding Adapters}"
                                      SelectedItem="{Binding SelectedAdapter}"
                                      Width="220"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Network Adapter"
                                      AutomationProperties.HelpText="Select which network adapter to monitor">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                    </Border>
                    
                    <!-- Polling Interval -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Polling Interval" Classes="CardTitle" />
                                <TextBlock Text="How often to sample network data" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding PollingIntervals}"
                                      SelectedItem="{Binding PollingIntervalMs}"
                                      Width="120"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Polling Interval"
                                      AutomationProperties.HelpText="How frequently network data is sampled" />
                        </Grid>
                    </Border>
                    
                    <!-- Speed Unit -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Speed Unit" Classes="CardTitle" />
                                <TextBlock Text="Display speeds in bits (Mbps) or bytes (MB/s)" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding SpeedUnits}"
                                      SelectedItem="{Binding SelectedSpeedUnit}"
                                      Width="160"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Speed Unit"
                                      AutomationProperties.HelpText="Choose to display speeds in bits per second or bytes per second">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource SpeedUnitConverter}}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                    </Border>
                    
                    <!-- Use IP Helper API -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Use IP Helper API" Classes="CardTitle" />
                                <TextBlock Text="More accurate readings but may require elevated helper" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding UseIpHelperApi}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Use IP Helper API"
                                          AutomationProperties.HelpText="Enable more accurate network readings, may require elevated helper" />
                        </Grid>
                    </Border>
                    
                    <!-- Per-App Tracking -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Per-App Network Tracking" Classes="CardTitle" />
                                <TextBlock Text="Track network usage for individual applications" Classes="Caption" />
                                <TextBlock Text="âš ï¸ Requires elevated helper"
                                           Classes="Caption"
                                           Foreground="{DynamicResource WarningBrush}"
                                           IsVisible="{Binding RequiresElevation}" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding IsPerAppTrackingEnabled}"
                                          IsEnabled="{Binding IsElevated}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Per-App Network Tracking"
                                          AutomationProperties.HelpText="Track network usage for individual applications. Requires elevated helper." />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Application Settings -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource UploadBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="ðŸ–¥ï¸" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Application Settings" Classes="SectionHeader" />
                            <TextBlock Text="Startup and behavior options" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Theme -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Theme" Classes="CardTitle" />
                                <TextBlock Text="Choose between dark, light, or system theme" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding ThemeOptions}"
                                      SelectedItem="{Binding SelectedTheme}"
                                      MinWidth="140"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Theme selector"
                                      AutomationProperties.HelpText="Choose the application color theme" />
                        </Grid>
                    </Border>
                    
                    <!-- Start with Windows -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Start with Windows" Classes="CardTitle" />
                                <TextBlock Text="Launch WireBound when Windows starts" Classes="Caption" />
                                <TextBlock Text="âš ï¸ Disabled in Windows Settings > Apps > Startup"
                                           Classes="Caption"
                                           Foreground="{DynamicResource WarningBrush}"
                                           IsVisible="{Binding IsStartupDisabledByUser}" />
                                <TextBlock Text="âš ï¸ Disabled by system policy"
                                           Classes="Caption"
                                           Foreground="{DynamicResource WarningBrush}"
                                           IsVisible="{Binding IsStartupDisabledByPolicy}" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding StartWithWindows}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Start with Windows"
                                          AutomationProperties.HelpText="Launch WireBound automatically when Windows starts" />
                        </Grid>
                    </Border>
                    
                    <!-- Minimize to Tray -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Minimize to System Tray" Classes="CardTitle" />
                                <TextBlock Text="Keep running in background when minimized" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding MinimizeToTray}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Minimize to System Tray"
                                          AutomationProperties.HelpText="Keep the application running in the background when minimized" />
                        </Grid>
                    </Border>
                    
                    <!-- Start Minimized -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Start Minimized" Classes="CardTitle" />
                                <TextBlock Text="Start the application minimized to system tray" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding StartMinimized}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Start Minimized"
                                          AutomationProperties.HelpText="Start the application minimized to the system tray" />
                        </Grid>
                    </Border>
                    
                    <!-- Check for Updates -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Check for Updates on Startup" Classes="CardTitle" />
                                <TextBlock Text="Privacy-safe: only checks GitHub Releases, no telemetry" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding CheckForUpdates}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Check for Updates on Startup"
                                          AutomationProperties.HelpText="Check GitHub for new releases when the application starts" />
                        </Grid>
                    </Border>

                    <!-- Auto-Download Updates (only visible in installed mode) -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16"
                            IsVisible="{Binding IsUpdateSupported}">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Auto-Download Updates" Classes="CardTitle" />
                                <TextBlock Text="Downloads updates silently. You'll be prompted before restart. Skipped on metered connections." Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding AutoDownloadUpdates}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Auto-Download Updates" />
                        </Grid>
                    </Border>

                    <!-- Up-to-date / Check Now (when no update available) -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16"
                            IsVisible="{Binding !UpdateAvailable}">
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBlock Text="You're on the latest version" Classes="CardTitle" />
                            <Button Grid.Column="1"
                                    Content="Check Now"
                                    Command="{Binding CheckForUpdateManuallyCommand}"
                                    VerticalAlignment="Center"
                                    AutomationProperties.Name="Check for Updates Now" />
                        </Grid>
                    </Border>

                    <!-- Update Available â€” multi-state card -->
                    <Border Background="{DynamicResource AccentBgTintBrush}" CornerRadius="12" Padding="16"
                            IsVisible="{Binding UpdateAvailable}">
                        <StackPanel Spacing="12">
                            <!-- Header: version info -->
                            <TextBlock Text="{Binding LatestVersion, StringFormat='Update available: v{0}'}"
                                       Classes="CardTitle"
                                       Foreground="{DynamicResource AccentBrush}" />

                            <!-- Error message -->
                            <TextBlock Text="{Binding UpdateError}"
                                       Foreground="{DynamicResource ErrorBrush}"
                                       TextWrapping="Wrap"
                                       IsVisible="{Binding UpdateError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                            <!-- State: Ready to download (installed mode) -->
                            <StackPanel Orientation="Horizontal" Spacing="8"
                                        IsVisible="{Binding IsUpdateSupported}">

                                <!-- Download button (not downloading, not ready) -->
                                <Button Content="Download Update"
                                        Command="{Binding DownloadUpdateCommand}"
                                        Classes="Accent"
                                        IsVisible="{Binding !IsDownloading}"
                                        AutomationProperties.Name="Download Update" />

                                <!-- Progress bar (downloading) -->
                                <StackPanel Orientation="Horizontal" Spacing="8"
                                            IsVisible="{Binding IsDownloading}">
                                    <ProgressBar Value="{Binding DownloadProgress}"
                                                 Minimum="0" Maximum="100"
                                                 Width="200" Height="20"
                                                 AutomationProperties.Name="Download Progress" />
                                    <TextBlock Text="{Binding DownloadProgress, StringFormat='{}{0}%'}"
                                               VerticalAlignment="Center" />
                                    <Button Content="Cancel"
                                            Command="{Binding CancelDownloadCommand}"
                                            AutomationProperties.Name="Cancel Download" />
                                </StackPanel>

                                <!-- Restart button (download complete) -->
                                <Button Content="Restart to Update"
                                        Command="{Binding ApplyUpdateAndRestartCommand}"
                                        Classes="Accent"
                                        IsVisible="{Binding IsReadyToRestart}"
                                        AutomationProperties.Name="Restart to Apply Update" />
                            </StackPanel>

                            <!-- State: Portable mode fallback -->
                            <StackPanel Spacing="4"
                                        IsVisible="{Binding !IsUpdateSupported}">
                                <Button Content="View Release"
                                        Command="{Binding OpenUpdateUrlCommand}"
                                        Classes="Accent"
                                        AutomationProperties.Name="View Release" />
                                <TextBlock Text="In-app updates are available with the installed version"
                                           Classes="Caption"
                                           Foreground="{DynamicResource MutedTextBrush}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Dashboard Customization -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource AccentBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="ðŸ“Š" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Dashboard Customization" Classes="SectionHeader" />
                            <TextBlock Text="Customize dashboard appearance and behavior" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Show System Metrics in Header -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Show System Metrics in Header" Classes="CardTitle" />
                                <TextBlock Text="Display CPU, Memory, and GPU in the dashboard header" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding ShowSystemMetricsInHeader}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Show System Metrics in Header" />
                        </Grid>
                    </Border>
                    
                    <!-- Default Time Range -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Default Time Range" Classes="CardTitle" />
                                <TextBlock Text="Initial time range for the dashboard chart" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding TimeRangeOptions}"
                                      SelectedItem="{Binding DefaultTimeRange}"
                                      Width="160"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Default Time Range" />
                        </Grid>
                    </Border>
                    
                    <!-- Show CPU Overlay by Default -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Show CPU Overlay by Default" Classes="CardTitle" />
                                <TextBlock Text="Automatically show CPU usage on the chart" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding ShowCpuOverlayByDefault}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Show CPU Overlay by Default" />
                        </Grid>
                    </Border>
                    
                    <!-- Show Memory Overlay by Default -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Show Memory Overlay by Default" Classes="CardTitle" />
                                <TextBlock Text="Automatically show memory usage on the chart" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding ShowMemoryOverlayByDefault}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Show Memory Overlay by Default" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Performance Settings -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource SuccessBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="âš¡" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Performance" Classes="SectionHeader" />
                            <TextBlock Text="Optimize application performance" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Performance Mode -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Performance Mode" Classes="CardTitle" />
                                <TextBlock Text="Reduce CPU usage by lowering update frequency" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding PerformanceModeEnabled}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Performance Mode" />
                        </Grid>
                    </Border>
                    
                    <!-- Chart Update Interval -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Chart Update Interval" Classes="CardTitle" />
                                <TextBlock Text="How often the chart refreshes (in milliseconds)" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding ChartUpdateIntervals}"
                                      SelectedItem="{Binding ChartUpdateIntervalMs}"
                                      Width="120"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Chart Update Interval" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Insights Settings -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource DownloadBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="ðŸ’¡" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Insights Page" Classes="SectionHeader" />
                            <TextBlock Text="Configure insights and analytics display" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Default Insights Period -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Default Insights Period" Classes="CardTitle" />
                                <TextBlock Text="Initial time period for insights data" Classes="Caption" />
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding InsightsPeriodOptions}"
                                      SelectedItem="{Binding DefaultInsightsPeriod}"
                                      Width="140"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="Default Insights Period">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource InsightsPeriodConverter}}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                    </Border>
                    
                    <!-- Show Correlation Insights -->
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Show Correlation Insights" Classes="CardTitle" />
                                <TextBlock Text="Display correlations between network and system metrics" Classes="Caption" />
                            </StackPanel>
                            <ToggleSwitch Grid.Column="1"
                                          IsChecked="{Binding ShowCorrelationInsights}"
                                          VerticalAlignment="Center"
                                          AutomationProperties.Name="Show Correlation Insights" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Elevation Status -->
            <Border Classes="ElevatedCard">
                <StackPanel Spacing="24">
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Border Background="{DynamicResource WarningBgTintBrush}" CornerRadius="8" Width="40" Height="40">
                            <TextBlock Text="ðŸ›¡ï¸" FontSize="20"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Elevated Helper" Classes="SectionHeader" />
                            <TextBlock Text="Helper process status for advanced features" Classes="Caption" />
                        </StackPanel>
                    </StackPanel>
                    
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="4">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="Current Status:" Classes="CardTitle" />
                                    <TextBlock Text="Helper Connected"
                                               Foreground="{DynamicResource SuccessBrush}"
                                               FontWeight="Bold"
                                               IsVisible="{Binding IsElevated}"
                                               VerticalAlignment="Center" />
                                    <TextBlock Text="Helper Not Connected"
                                               Foreground="{DynamicResource WarningBrush}"
                                               FontWeight="Bold"
                                               IsVisible="{Binding !IsElevated}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                                <TextBlock Text="Per-app network tracking requires elevated helper"
                                           Classes="Caption"
                                           IsVisible="{Binding RequiresElevation}" />
                                <TextBlock Text="All features are available"
                                           Classes="Caption"
                                           Foreground="{DynamicResource SuccessBrush}"
                                           IsVisible="{Binding IsElevated}" />
                            </StackPanel>
                            <Button Grid.Column="1"
                                    Content="ðŸ›¡ï¸ Start Helper"
                                    Command="{Binding RequestElevationCommand}"
                                    IsEnabled="{Binding !IsRequestingElevation}"
                                    IsVisible="{Binding RequiresElevation}"
                                    Classes="Warning"
                                    VerticalAlignment="Center"
                                    AutomationProperties.Name="Start Elevated Helper"
                                    AutomationProperties.HelpText="Start a minimal elevated helper process for advanced features" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Auto-save note -->
            <TextBlock Text="Settings are saved automatically"
                       Classes="Caption"
                       HorizontalAlignment="Center"
                       Opacity="0.6" />

            <!-- Data Management -->
            <Border Classes="ElevatedCard" Margin="0,8,0,0">
                <StackPanel Spacing="12">
                    <StackPanel Spacing="2">
                        <TextBlock Text="Data Management" Classes="SectionHeader" />
                        <TextBlock Text="Export usage data or back up the database" Classes="Caption" />
                    </StackPanel>

                    <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto">
                        <TextBlock Text="Export daily usage data to CSV or back up the database."
                                   Classes="Caption"
                                   Opacity="0.7"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="1"
                                Content="Export CSV"
                                Command="{Binding ExportDailyDataCommand}"
                                IsEnabled="{Binding !IsExporting}"
                                Classes="Accent"
                                Margin="0,0,8,0"
                                AutomationProperties.Name="Export Daily Data"
                                AutomationProperties.HelpText="Export daily usage data to a CSV file" />
                        <Button Grid.Column="2"
                                Content="Backup DB"
                                Command="{Binding BackupDatabaseCommand}"
                                IsEnabled="{Binding !IsExporting}"
                                AutomationProperties.Name="Backup Database"
                                AutomationProperties.HelpText="Create a backup copy of the database" />
                    </Grid>

                    <TextBlock Text="{Binding ExportStatus}"
                               Classes="Caption"
                               Opacity="0.7"
                               IsVisible="{Binding ExportStatus, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                </StackPanel>
            </Border>
                   
        </StackPanel>
    </ScrollViewer>
</UserControl>
