<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WireBound.ViewModels"
             xmlns:ext="clr-namespace:WireBound.Extensions"
             x:Class="WireBound.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             BackgroundColor="{StaticResource BackgroundColor}">

    <!-- 
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WireBound Settings v2.0 - Configuration Center
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -->

    <ScrollView Padding="28">
        <VerticalStackLayout Spacing="24">
            
            <!-- Header -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Settings" 
                       Style="{StaticResource PageTitleStyle}">
                    <Label.Shadow>
                        <Shadow Brush="{StaticResource GlowDownloadColor}" 
                                Offset="0,0" 
                                Radius="8" 
                                Opacity="0.2" />
                    </Label.Shadow>
                </Label>
                <Label Text="Configure monitoring options"
                       Style="{StaticResource SubtitleStyle}" />
            </VerticalStackLayout>

            <!-- Network Settings Card -->
            <Border Style="{StaticResource ElevatedCardStyle}">
                <VerticalStackLayout Spacing="24">
                    
                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border BackgroundColor="#1500E5FF"
                                StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                WidthRequest="40"
                                HeightRequest="40">
                            <Label Text="ðŸ“¡" 
                                   FontSize="20"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Monitoring Settings"
                                   Style="{StaticResource SectionHeaderStyle}" />
                            <Label Text="Configure how network data is collected"
                                   Style="{StaticResource CaptionStyle}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    
                    <!-- Network Adapter -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto" RowSpacing="4">
                            <Label Text="Network Adapter"
                                   Style="{StaticResource CardTitleStyle}"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="1"
                                   Text="Select which adapter to monitor"
                                   Style="{StaticResource CaptionStyle}" />
                            <Picker Grid.Column="1"
                                    Grid.RowSpan="2"
                                    ItemsSource="{Binding Adapters}"
                                    SelectedItem="{Binding SelectedAdapter}"
                                    ItemDisplayBinding="{Binding Name}"
                                    Style="{StaticResource ModernPickerStyle}"
                                    WidthRequest="220"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                    
                    <!-- Polling Interval -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto" RowSpacing="4">
                            <Label Text="Polling Interval"
                                   Style="{StaticResource CardTitleStyle}"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="1"
                                   Text="How often to sample network data"
                                   Style="{StaticResource CaptionStyle}" />
                            <Picker Grid.Column="1"
                                    Grid.RowSpan="2"
                                    ItemsSource="{Binding PollingIntervals}"
                                    SelectedItem="{Binding PollingIntervalMs}"
                                    Style="{StaticResource ModernPickerStyle}"
                                    WidthRequest="120"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                    
                    <!-- Use IP Helper API -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Use IP Helper API"
                                       Style="{StaticResource CardTitleStyle}" />
                                <Label Text="More accurate readings but may require elevation"
                                       Style="{StaticResource CaptionStyle}" />
                            </VerticalStackLayout>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding UseIpHelperApi}"
                                    OnColor="{StaticResource PrimaryColor}"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                    
                    <!-- Per-App Network Tracking -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Per-App Network Tracking"
                                       Style="{StaticResource CardTitleStyle}" />
                                <Label Text="Track network usage for individual applications"
                                       Style="{StaticResource CaptionStyle}" />
                                <Label Text="âš ï¸ Requires administrator privileges"
                                       Style="{StaticResource CaptionStyle}"
                                       TextColor="{StaticResource WarningColor}"
                                       IsVisible="{Binding RequiresElevation}" />
                            </VerticalStackLayout>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsPerAppTrackingEnabled}"
                                    IsEnabled="{Binding IsElevated}"
                                    OnColor="{StaticResource PrimaryColor}"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </VerticalStackLayout>
            </Border>

            <!-- Application Settings Card -->
            <Border Style="{StaticResource ElevatedCardStyle}">
                <VerticalStackLayout Spacing="24">
                    
                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border BackgroundColor="#15FF6B35"
                                StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                WidthRequest="40"
                                HeightRequest="40">
                            <Label Text="ðŸ–¥ï¸" 
                                   FontSize="20"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Application Settings"
                                   Style="{StaticResource SectionHeaderStyle}" />
                            <Label Text="Startup and behavior options"
                                   Style="{StaticResource CaptionStyle}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    
                    <!-- Start with Windows -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="{ext:Localize Settings_StartWithWindows}"
                                       Style="{StaticResource CardTitleStyle}" />
                                <Label Text="{ext:Localize Settings_StartWithWindowsDescription}"
                                       Style="{StaticResource CaptionStyle}" />
                                <HorizontalStackLayout Spacing="8"
                                                       IsVisible="{Binding IsStartupDisabledByUser}">
                                    <Label Text="âš "
                                           FontSize="14"
                                           FontFamily="Segoe MDL2 Assets"
                                           TextColor="{StaticResource WarningColor}"
                                           VerticalOptions="Center"
                                           SemanticProperties.Description="Warning icon" />
                                    <Label Text="{ext:Localize Settings_StartupDisabledByUser}"
                                           Style="{StaticResource CaptionStyle}"
                                           TextColor="{StaticResource WarningColor}" />
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="8"
                                                       IsVisible="{Binding IsStartupDisabledByPolicy}">
                                    <Label Text="&#xE72E;"
                                           FontSize="14"
                                           FontFamily="Segoe MDL2 Assets"
                                           TextColor="{StaticResource ErrorColor}"
                                           VerticalOptions="Center"
                                           SemanticProperties.Description="Lock icon" />
                                    <Label Text="{ext:Localize Settings_StartupDisabledByPolicy}"
                                           Style="{StaticResource CaptionStyle}"
                                           TextColor="{StaticResource ErrorColor}" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding StartWithWindows}"
                                    IsEnabled="{Binding IsStartupDisabledByPolicy, Converter={StaticResource InverseBoolConverter}}"
                                    OnColor="{StaticResource PrimaryColor}"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                    
                    <!-- Minimize to Tray -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Minimize to System Tray"
                                       Style="{StaticResource CardTitleStyle}" />
                                <Label Text="Keep running in background when minimized"
                                       Style="{StaticResource CaptionStyle}" />
                            </VerticalStackLayout>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding MinimizeToTray}"
                                    OnColor="{StaticResource PrimaryColor}"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </VerticalStackLayout>
            </Border>

            <!-- Elevation Status Card -->
            <Border Style="{StaticResource ElevatedCardStyle}">
                <VerticalStackLayout Spacing="24">
                    
                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border BackgroundColor="#15FFB627"
                                StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                WidthRequest="40"
                                HeightRequest="40">
                            <Label Text="ðŸ›¡ï¸" 
                                   FontSize="20"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Administrator Privileges"
                                   Style="{StaticResource SectionHeaderStyle}" />
                            <Label Text="Elevation status for advanced features"
                                   Style="{StaticResource CaptionStyle}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    
                    <!-- Elevation Status -->
                    <Border BackgroundColor="{StaticResource BorderSubtleColor}"
                            StrokeShape="RoundRectangle 12"
                            Padding="16">
                        <Grid ColumnDefinitions="*, Auto">
                            <VerticalStackLayout Spacing="4">
                                <HorizontalStackLayout Spacing="8">
                                    <Label Text="Current Status:"
                                           Style="{StaticResource CardTitleStyle}" />
                                    <Label Text="Running as Administrator"
                                           TextColor="{StaticResource SuccessColor}"
                                           FontAttributes="Bold"
                                           IsVisible="{Binding IsElevated}"
                                           VerticalOptions="Center" />
                                    <Label Text="Standard User"
                                           TextColor="{StaticResource WarningColor}"
                                           FontAttributes="Bold"
                                           IsVisible="{Binding IsElevated, Converter={StaticResource InverseBoolConverter}}"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Label Text="Per-app network tracking requires administrator privileges"
                                       Style="{StaticResource CaptionStyle}"
                                       IsVisible="{Binding RequiresElevation}" />
                                <Label Text="All features are available"
                                       Style="{StaticResource CaptionStyle}"
                                       TextColor="{StaticResource SuccessColor}"
                                       IsVisible="{Binding IsElevated}" />
                            </VerticalStackLayout>
                            <Button Grid.Column="1"
                                    Text="ðŸ›¡ï¸ Elevate"
                                    Command="{Binding RequestElevationCommand}"
                                    IsEnabled="{Binding IsRequestingElevation, Converter={StaticResource InverseBoolConverter}}"
                                    IsVisible="{Binding RequiresElevation}"
                                    Style="{StaticResource WarningButtonStyle}"
                                    VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </VerticalStackLayout>
            </Border>

            <!-- Save Button -->
            <Button Text="ðŸ’¾  Save Settings"
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    HeightRequest="52"
                    HorizontalOptions="Fill" />

            <!-- Status Message -->
            <Border BackgroundColor="{StaticResource SuccessBannerColor}"
                    StrokeShape="RoundRectangle 10"
                    Padding="16,12"
                    IsVisible="{Binding HasStatusMessage}">
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Label Text="âœ“" 
                           FontSize="16" 
                           TextColor="{StaticResource SuccessColor}"
                           VerticalOptions="Center" />
                    <Label Text="{Binding StatusMessage}"
                           FontSize="14"
                           TextColor="{StaticResource SuccessColor}"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>
                   
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
