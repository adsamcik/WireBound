<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WireBound.Avalonia.ViewModels"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:controls="using:WireBound.Avalonia.Controls"
             x:Class="WireBound.Avalonia.Views.OverviewView"
             x:DataType="vm:OverviewViewModel"
             Background="{DynamicResource BackgroundBrush}"
             AutomationProperties.Name="Overview View">

    <Grid RowDefinitions="Auto, *" Margin="28">
        
        <!-- PAGE HEADER -->
        <Grid ColumnDefinitions="Auto, *, Auto" Margin="0,0,0,24">
            <!-- Title and Subtitle -->
            <StackPanel Spacing="4">
                <TextBlock Text="Overview" Classes="PageTitle" />
                <TextBlock Text="Real-time network and system monitoring" Classes="Subtitle" />
            </StackPanel>
            
            <!-- Adapter Selector - Compact -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" 
                        HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                <ComboBox ItemsSource="{Binding Adapters}"
                          SelectedItem="{Binding SelectedAdapter}"
                          MinWidth="280"
                          VerticalAlignment="Center"
                          AutomationProperties.Name="Network Adapter Selection"
                          AutomationProperties.HelpText="Select which network adapter to monitor">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <ToggleButton IsChecked="{Binding ShowAdvancedAdapters}"
                              ToolTip.Tip="Show VM and container adapters"
                              Padding="8,6"
                              VerticalAlignment="Center"
                              AutomationProperties.Name="Show Advanced Adapters">
                    <TextBlock Text="âš™ï¸" FontSize="14" />
                </ToggleButton>
            </StackPanel>
            
            <!-- Quick System Strip -->
            <controls:SystemHealthStrip Grid.Column="2"
                                        CpuPercent="{Binding CpuPercent}"
                                        MemoryPercent="{Binding MemoryPercent}"
                                        GpuPercent="{Binding GpuPercent}"
                                        ShowGpu="{Binding IsGpuAvailable}"
                                        VerticalAlignment="Center"
                                        AutomationProperties.Name="System Health Strip"
                                        AutomationProperties.HelpText="Quick view of CPU, RAM, and GPU usage" />
        </Grid>

        <!-- SCROLLABLE CONTENT -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid RowDefinitions="Auto, Auto, Auto" ColumnDefinitions="*, *">

                <!-- DOWNLOAD SPEED CARD - Hero Design -->
                <Border Classes="ElevatedCard" Margin="0,0,10,0">
                    <Grid RowDefinitions="Auto, Auto, Auto">
                        <!-- Header Row -->
                        <Grid ColumnDefinitions="Auto, *, Auto">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{DynamicResource DownloadBgTintBrush}" CornerRadius="6" Width="28" Height="28">
                                    <TextBlock Text="â†“" FontSize="16" 
                                               Foreground="{DynamicResource DownloadBrush}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                                </Border>
                                <TextBlock Text="Download" Classes="CardTitle" VerticalAlignment="Center" />
                            </StackPanel>
                            <!-- Peak in header, right-aligned -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                <TextBlock Text="Peak:" Classes="Caption" Opacity="0.6" VerticalAlignment="Center" />
                                <TextBlock Text="{Binding PeakDownloadSpeed}"
                                           FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource DownloadColorDim}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                        
                        <!-- Hero Speed Display -->
                        <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,16,0,16">
                            <TextBlock Text="{Binding DownloadSpeed}"
                                       FontSize="48" FontWeight="Bold"
                                       Foreground="{DynamicResource DownloadBrush}"
                                       HorizontalAlignment="Center"
                                       MinWidth="200"
                                       TextAlignment="Center" />
                            <!-- Trend indicator -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4" Margin="0,4,0,0">
                                <TextBlock Text="{Binding DownloadTrendIcon}"
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{Binding DownloadTrendText}"
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Footer Stats -->
                        <Border Grid.Row="2" 
                                Background="{DynamicResource BorderSubtleBrush}"
                                CornerRadius="6"
                                Padding="12,8">
                            <Grid ColumnDefinitions="*, Auto, *">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="Today" Classes="Caption" Opacity="0.7" VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding TodayDownload}"
                                               FontSize="13" FontWeight="Bold"
                                               Foreground="{DynamicResource DownloadBrush}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                                <Border Grid.Column="1" Width="1" Background="{DynamicResource MutedTextBrush}" Opacity="0.3" Margin="8,2" />
                                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" HorizontalAlignment="Right">
                                    <TextBlock Text="Session" Classes="Caption" Opacity="0.7" VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding SessionDownload}"
                                               FontSize="13" FontWeight="Bold"
                                               Foreground="{DynamicResource DownloadBrush}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- UPLOAD SPEED CARD - Hero Design -->
                <Border Grid.Column="1" Classes="ElevatedCard" Margin="10,0,0,0">
                    <Grid RowDefinitions="Auto, Auto, Auto">
                        <!-- Header Row -->
                        <Grid ColumnDefinitions="Auto, *, Auto">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{DynamicResource UploadBgTintBrush}" CornerRadius="6" Width="28" Height="28">
                                    <TextBlock Text="â†‘" FontSize="16" 
                                               Foreground="{DynamicResource UploadBrush}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                                </Border>
                                <TextBlock Text="Upload" Classes="CardTitle" VerticalAlignment="Center" />
                            </StackPanel>
                            <!-- Peak in header, right-aligned -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                <TextBlock Text="Peak:" Classes="Caption" Opacity="0.6" VerticalAlignment="Center" />
                                <TextBlock Text="{Binding PeakUploadSpeed}"
                                           FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource UploadColorDim}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                        
                        <!-- Hero Speed Display -->
                        <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,16,0,16">
                            <TextBlock Text="{Binding UploadSpeed}"
                                       FontSize="48" FontWeight="Bold"
                                       Foreground="{DynamicResource UploadBrush}"
                                       HorizontalAlignment="Center"
                                       MinWidth="200"
                                       TextAlignment="Center" />
                            <!-- Trend indicator -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4" Margin="0,4,0,0">
                                <TextBlock Text="{Binding UploadTrendIcon}"
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{Binding UploadTrendText}"
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Footer Stats -->
                        <Border Grid.Row="2" 
                                Background="{DynamicResource BorderSubtleBrush}"
                                CornerRadius="6"
                                Padding="12,8">
                            <Grid ColumnDefinitions="*, Auto, *">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="Today" Classes="Caption" Opacity="0.7" VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding TodayUpload}"
                                               FontSize="13" FontWeight="Bold"
                                               Foreground="{DynamicResource UploadBrush}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                                <Border Grid.Column="1" Width="1" Background="{DynamicResource MutedTextBrush}" Opacity="0.3" Margin="8,2" />
                                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" HorizontalAlignment="Right">
                                    <TextBlock Text="Session" Classes="Caption" Opacity="0.7" VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding SessionUpload}"
                                               FontSize="13" FontWeight="Bold"
                                               Foreground="{DynamicResource UploadBrush}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- LIVE NETWORK CHART SECTION -->
                <Border Grid.Row="1" Grid.ColumnSpan="2" Classes="ElevatedCard" Margin="0,20,0,0">
                    <Grid RowDefinitions="Auto, *, Auto">
                        <!-- Chart Header with Controls -->
                        <Grid ColumnDefinitions="Auto, *, Auto" Margin="0,0,0,12">
                            <!-- Time Range Buttons -->
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="Time Range:" 
                                           Classes="Caption" 
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0" />
                                <Button Content="1m"
                                        Classes="Secondary"
                                        Padding="12,6"
                                        Command="{Binding SetTimeRangeCommand}"
                                        CommandParameter="{x:Static vm:TimeRange.OneMinute}"
                                        AutomationProperties.Name="1 Minute Range" />
                                <Button Content="5m"
                                        Classes="Secondary"
                                        Padding="12,6"
                                        Command="{Binding SetTimeRangeCommand}"
                                        CommandParameter="{x:Static vm:TimeRange.FiveMinutes}"
                                        AutomationProperties.Name="5 Minutes Range" />
                                <Button Content="15m"
                                        Classes="Secondary"
                                        Padding="12,6"
                                        Command="{Binding SetTimeRangeCommand}"
                                        CommandParameter="{x:Static vm:TimeRange.FifteenMinutes}"
                                        AutomationProperties.Name="15 Minutes Range" />
                                <Button Content="1h"
                                        Classes="Secondary"
                                        Padding="12,6"
                                        Command="{Binding SetTimeRangeCommand}"
                                        CommandParameter="{x:Static vm:TimeRange.OneHour}"
                                        AutomationProperties.Name="1 Hour Range" />
                            </StackPanel>

                            <!-- Layer Toggle Buttons -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Overlay:" 
                                           Classes="Caption" 
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0" />
                                <ToggleButton IsChecked="{Binding ShowCpuOverlay}"
                                              Padding="10,6"
                                              ToolTip.Tip="Toggle CPU usage overlay"
                                              AutomationProperties.Name="Toggle CPU Overlay">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <Ellipse Width="8" Height="8" Fill="{DynamicResource CpuBrush}" VerticalAlignment="Center" />
                                        <TextBlock Text="CPU" FontSize="12" VerticalAlignment="Center" />
                                    </StackPanel>
                                </ToggleButton>
                                <ToggleButton IsChecked="{Binding ShowMemoryOverlay}"
                                              Padding="10,6"
                                              ToolTip.Tip="Toggle Memory usage overlay"
                                              AutomationProperties.Name="Toggle Memory Overlay">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <Ellipse Width="8" Height="8" Fill="{DynamicResource MemoryBrush}" VerticalAlignment="Center" />
                                        <TextBlock Text="RAM" FontSize="12" VerticalAlignment="Center" />
                                    </StackPanel>
                                </ToggleButton>
                            </StackPanel>
                        </Grid>

                        <!-- Chart -->
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding ChartSeries}"
                                            XAxes="{Binding ChartXAxes}"
                                            YAxes="{Binding ChartYAxes}"
                                            MinHeight="280"
                                            TooltipPosition="Hidden"
                                            ZoomMode="X"
                                            AutomationProperties.Name="Live Network Speed Chart"
                                            AutomationProperties.HelpText="Real-time chart showing download and upload speeds" />

                        <!-- Chart Legend -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="24" Margin="0,12,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Width="16" Height="3" CornerRadius="1" Background="{DynamicResource DownloadBrush}" VerticalAlignment="Center" />
                                <TextBlock Text="Download" Classes="Caption" VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Width="16" Height="3" CornerRadius="1" Background="{DynamicResource UploadBrush}" VerticalAlignment="Center" />
                                <TextBlock Text="Upload" Classes="Caption" VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="6" IsVisible="{Binding ShowCpuOverlay}">
                                <Border Width="16" Height="2" CornerRadius="1" Background="{DynamicResource CpuBrush}" VerticalAlignment="Center" 
                                        Opacity="0.7" />
                                <TextBlock Text="CPU %" Classes="Caption" VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="6" IsVisible="{Binding ShowMemoryOverlay}">
                                <Border Width="16" Height="2" CornerRadius="1" Background="{DynamicResource MemoryBrush}" VerticalAlignment="Center"
                                        Opacity="0.7" />
                                <TextBlock Text="RAM %" Classes="Caption" VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- BOTTOM ROW: SESSION STATS + SYSTEM HEALTH -->
                
                <!-- SESSION STATS CARD -->
                <Border Grid.Row="2" Classes="ElevatedCard" Margin="0,20,10,0">
                    <Grid RowDefinitions="Auto, *">
                        <!-- Card Header -->
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,16">
                            <Border Background="{DynamicResource AccentBgTintBrush}" CornerRadius="6" Width="28" Height="28">
                                <TextBlock Text="ðŸ“Š" FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>
                            <TextBlock Text="Session Stats" Classes="CardTitle" VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Stats Grid -->
                        <Grid Grid.Row="1" RowDefinitions="Auto, Auto, Auto, Auto" ColumnDefinitions="Auto, *">
                            <!-- Downloaded -->
                            <TextBlock Text="Downloaded" 
                                       Classes="Caption" 
                                       Opacity="0.7"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />
                            <TextBlock Grid.Column="1"
                                       Text="{Binding SessionDownload}"
                                       FontSize="16" FontWeight="Bold"
                                       Foreground="{DynamicResource DownloadBrush}"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />

                            <!-- Uploaded -->
                            <TextBlock Grid.Row="1"
                                       Text="Uploaded" 
                                       Classes="Caption" 
                                       Opacity="0.7"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />
                            <TextBlock Grid.Row="1" Grid.Column="1"
                                       Text="{Binding SessionUpload}"
                                       FontSize="16" FontWeight="Bold"
                                       Foreground="{DynamicResource UploadBrush}"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />

                            <!-- Peak Download -->
                            <TextBlock Grid.Row="2"
                                       Text="Peak Download" 
                                       Classes="Caption" 
                                       Opacity="0.7"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />
                            <TextBlock Grid.Row="2" Grid.Column="1"
                                       Text="{Binding PeakDownloadSpeed}"
                                       FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource PrimaryTextBrush}"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8" />

                            <!-- Peak Upload -->
                            <TextBlock Grid.Row="3"
                                       Text="Peak Upload" 
                                       Classes="Caption" 
                                       Opacity="0.7"
                                       VerticalAlignment="Center" />
                            <TextBlock Grid.Row="3" Grid.Column="1"
                                       Text="{Binding PeakUploadSpeed}"
                                       FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource PrimaryTextBrush}"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center" />
                        </Grid>
                    </Grid>
                </Border>

                <!-- SYSTEM HEALTH CARD -->
                <Border Grid.Row="2" Grid.Column="1" Classes="ElevatedCard" Margin="10,20,0,0">
                    <Grid RowDefinitions="Auto, *">
                        <!-- Card Header -->
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,16">
                            <Border Background="{DynamicResource CpuBgTintBrush}" CornerRadius="6" Width="28" Height="28">
                                <TextBlock Text="ðŸ’»" FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>
                            <TextBlock Text="System Health" Classes="CardTitle" VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Gauges Row -->
                        <Grid Grid.Row="1" ColumnDefinitions="*, Auto, *, Auto, *">
                            <!-- CPU Gauge -->
                            <StackPanel HorizontalAlignment="Center" Spacing="8">
                                <controls:CircularGauge Classes="Normal"
                                                        Value="{Binding CpuPercent}"
                                                        GaugeColor="{DynamicResource CpuBrush}"
                                                        BackgroundColor="{DynamicResource CpuBgTintBrush}"
                                                        Label="CPU"
                                                        ShowLabel="True" />
                                <TextBlock Text="{Binding CpuUsageFormatted}"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{DynamicResource CpuBrush}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- Separator -->
                            <Border Grid.Column="1"
                                    Width="1"
                                    Background="{DynamicResource DividerBrush}"
                                    Margin="16,8"
                                    VerticalAlignment="Stretch" />

                            <!-- Memory Gauge -->
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center" Spacing="8">
                                <controls:CircularGauge Classes="Normal"
                                                        Value="{Binding MemoryPercent}"
                                                        GaugeColor="{DynamicResource MemoryBrush}"
                                                        BackgroundColor="{DynamicResource MemoryBgTintBrush}"
                                                        Label="Memory"
                                                        ShowLabel="True" />
                                <TextBlock Text="{Binding MemoryUsageFormatted}"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{DynamicResource MemoryBrush}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- GPU Section (conditionally visible) -->
                            <Border Grid.Column="3"
                                    Width="1"
                                    Background="{DynamicResource DividerBrush}"
                                    Margin="16,8"
                                    VerticalAlignment="Stretch"
                                    IsVisible="{Binding IsGpuAvailable}" />

                            <StackPanel Grid.Column="4" 
                                        HorizontalAlignment="Center" 
                                        Spacing="8"
                                        IsVisible="{Binding IsGpuAvailable}">
                                <controls:CircularGauge Classes="Normal"
                                                        Value="{Binding GpuPercent, FallbackValue=0}"
                                                        GaugeColor="{DynamicResource GpuBrush}"
                                                        BackgroundColor="{DynamicResource GpuBgTintBrush}"
                                                        Label="GPU"
                                                        ShowLabel="True" />
                                <TextBlock Text="{Binding GpuUsageFormatted}"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{DynamicResource GpuBrush}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- Placeholder when GPU not available -->
                            <StackPanel Grid.Column="3" Grid.ColumnSpan="2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        IsVisible="{Binding !IsGpuAvailable}">
                                <TextBlock Text="GPU monitoring"
                                           Classes="Caption"
                                           Opacity="0.5"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="not available"
                                           Classes="Caption"
                                           Opacity="0.5"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>

            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
