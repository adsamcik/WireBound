<UserControl x:Class="WireBound.Views.HistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             Background="Transparent">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="8">
            <!-- Header -->
            <TextBlock Text="Usage History" Style="{StaticResource HeaderText}" Margin="8,0,0,16"/>

            <!-- Summary Cards Row -->
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Today Card -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="ðŸ“… Today" Style="{StaticResource SubHeaderText}" FontSize="14"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="â†“" Foreground="{StaticResource DownloadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding TodayReceived}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource DownloadBrush}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="â†‘" Foreground="{StaticResource UploadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding TodaySent}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource UploadBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- This Week Card -->
                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="ðŸ“† This Week" Style="{StaticResource SubHeaderText}" FontSize="14"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="â†“" Foreground="{StaticResource DownloadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding WeekReceived}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource DownloadBrush}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="â†‘" Foreground="{StaticResource UploadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding WeekSent}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource UploadBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- This Month Card -->
                <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="ðŸ—“ï¸ This Month" Style="{StaticResource SubHeaderText}" FontSize="14"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="â†“" Foreground="{StaticResource DownloadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding MonthReceived}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource DownloadBrush}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="â†‘" Foreground="{StaticResource UploadBrush}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding MonthSent}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource UploadBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Insights Row -->
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Avg Daily" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding AverageDaily}" FontSize="18" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Peak Day" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding PeakDay}" FontSize="14" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,4,0,0"/>
                        <TextBlock Text="{Binding PeakDayUsage}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Most Active" Style="{StaticResource BodyText}"/>
                        <TextBlock FontSize="14" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,4,0,0">
                            <Run Text="{Binding MostActiveHour}"/> <Run Text="{Binding MostActiveDay}"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="vs Last Week" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding TrendComparison}" FontSize="18" FontWeight="SemiBold" Margin="0,4,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="#E74C3C"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsTrendPositive}" Value="True">
                                            <Setter Property="Foreground" Value="#2ECC71"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Quick Filters -->
            <Border Style="{StaticResource CardStyle}" Margin="8,0,8,8">
                <StackPanel>
                    <TextBlock Text="Quick Filters" Style="{StaticResource SubHeaderText}" Margin="0,0,0,12"/>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Today" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadTodayCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="Last 7 Days" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadLast7DaysCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="Last 30 Days" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadLast30DaysCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="This Month" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadThisMonthCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="12 Weeks" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadLast12WeeksCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="ðŸ”„ Refresh" 
                                Style="{StaticResource PrimaryButton}" 
                                Command="{Binding RefreshCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Total Stats -->
            <Grid Margin="0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Downloaded" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding TotalReceived}" 
                                   FontSize="20" FontWeight="SemiBold"
                                   Foreground="{StaticResource DownloadBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Uploaded" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding TotalSent}" 
                                   FontSize="20" FontWeight="SemiBold"
                                   Foreground="{StaticResource UploadBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Period Downloaded" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding PeriodReceived}" 
                                   FontSize="20" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Period Uploaded" Style="{StaticResource BodyText}"/>
                        <TextBlock Text="{Binding PeriodSent}" 
                                   FontSize="20" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- View Mode Tabs -->
            <Border Style="{StaticResource CardStyle}" Margin="8,8,8,8">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <RadioButton Content="Hourly" GroupName="ViewMode" 
                                     IsChecked="{Binding SelectedViewMode, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}"
                                     Style="{StaticResource {x:Type RadioButton}}" Margin="0,0,16,0"/>
                        <RadioButton Content="Daily" GroupName="ViewMode" 
                                     IsChecked="{Binding SelectedViewMode, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}"
                                     Style="{StaticResource {x:Type RadioButton}}" Margin="0,0,16,0"/>
                        <RadioButton Content="Weekly" GroupName="ViewMode" 
                                     IsChecked="{Binding SelectedViewMode, Converter={StaticResource IntToBoolConverter}, ConverterParameter=2}"
                                     Style="{StaticResource {x:Type RadioButton}}"/>
                    </StackPanel>

                    <!-- Hourly Chart (visible when SelectedViewMode = 0) -->
                    <StackPanel Visibility="{Binding SelectedViewMode, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0}">
                        <TextBlock Text="ðŸ“Š Hourly Usage" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                        <lvc:CartesianChart Series="{Binding HourlySeries}"
                                            XAxes="{Binding HourlyXAxes}"
                                            YAxes="{Binding YAxes}"
                                            Height="300"
                                            ZoomMode="X"
                                            TooltipPosition="Top"/>
                    </StackPanel>

                    <!-- Daily Chart (visible when SelectedViewMode = 1) -->
                    <StackPanel Visibility="{Binding SelectedViewMode, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}">
                        <TextBlock Text="ðŸ“Š Daily Usage" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                        <lvc:CartesianChart Series="{Binding DailySeries}"
                                            XAxes="{Binding XAxes}"
                                            YAxes="{Binding YAxes}"
                                            Height="300"
                                            ZoomMode="X"
                                            TooltipPosition="Top"/>
                    </StackPanel>

                    <!-- Weekly Chart (visible when SelectedViewMode = 2) -->
                    <StackPanel Visibility="{Binding SelectedViewMode, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}">
                        <TextBlock Text="ðŸ“Š Weekly Usage" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                        <lvc:CartesianChart Series="{Binding WeeklySeries}"
                                            XAxes="{Binding WeeklyXAxes}"
                                            YAxes="{Binding YAxes}"
                                            Height="300"
                                            ZoomMode="X"
                                            TooltipPosition="Top"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Usage Patterns -->
            <Grid Margin="0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="ðŸ• Usage by Hour of Day" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                        <lvc:CartesianChart Series="{Binding HourOfDaySeries}"
                                            XAxes="{Binding HourOfDayXAxes}"
                                            YAxes="{Binding YAxes}"
                                            Height="200"
                                            TooltipPosition="Top"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="ðŸ“… Usage by Day of Week" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                        <lvc:CartesianChart Series="{Binding DayOfWeekSeries}"
                                            XAxes="{Binding DayOfWeekXAxes}"
                                            YAxes="{Binding YAxes}"
                                            Height="200"
                                            TooltipPosition="Top"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Daily Breakdown Table -->
            <Border Style="{StaticResource CardStyle}" Margin="8,0,8,8" 
                    Visibility="{Binding SelectedViewMode, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}">
                <StackPanel>
                    <TextBlock Text="ðŸ“‹ Daily Breakdown" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                    <DataGrid ItemsSource="{Binding DailyUsages}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Background="Transparent"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              BorderThickness="0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="{StaticResource BorderBrush}"
                              MaxHeight="300">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat='{}{0:yyyy-MM-dd}'}" Width="*"/>
                            <DataGridTextColumn Header="Downloaded" Binding="{Binding BytesReceived, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                            <DataGridTextColumn Header="Uploaded" Binding="{Binding BytesSent, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                            <DataGridTextColumn Header="Total" Binding="{Binding TotalBytes, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Weekly Breakdown Table -->
            <Border Style="{StaticResource CardStyle}" Margin="8,0,8,8"
                    Visibility="{Binding SelectedViewMode, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}">
                <StackPanel>
                    <TextBlock Text="ðŸ“‹ Weekly Breakdown" Style="{StaticResource SubHeaderText}" Margin="0,0,0,16"/>
                    <DataGrid ItemsSource="{Binding WeeklyUsages}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Background="Transparent"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              BorderThickness="0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="{StaticResource BorderBrush}"
                              MaxHeight="300">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Week" Binding="{Binding WeekStart, StringFormat='{}{0:yyyy-MM-dd}'}" Width="*"/>
                            <DataGridTextColumn Header="Downloaded" Binding="{Binding BytesReceived, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                            <DataGridTextColumn Header="Uploaded" Binding="{Binding BytesSent, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                            <DataGridTextColumn Header="Total" Binding="{Binding TotalBytes, Converter={StaticResource BytesToStringConverter}}" Width="*"/>
                            <DataGridTextColumn Header="Active Days" Binding="{Binding ActiveDays}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
