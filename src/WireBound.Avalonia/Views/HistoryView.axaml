<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WireBound.Avalonia.ViewModels"
             xmlns:conv="using:WireBound.Avalonia.Converters"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="WireBound.Avalonia.Views.HistoryView"
             x:DataType="vm:HistoryViewModel"
             Background="{DynamicResource BackgroundBrush}"
             AutomationProperties.Name="History View">

    <ScrollViewer>
        <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto" Margin="28">
            
            <!-- HEADER ROW -->
            <Grid ColumnDefinitions="*, Auto">
                <StackPanel Spacing="4">
                    <TextBlock Text="History" Classes="PageTitle" />
                    <TextBlock Text="Network usage over time" Classes="Subtitle" />
                </StackPanel>
                
                <!-- Controls: Period Selector -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <Border Classes="CompactCard" Padding="14,10">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="Period" Classes="Caption" VerticalAlignment="Center" />
                            <ComboBox ItemsSource="{Binding PeriodOptions}"
                                      SelectedItem="{Binding SelectedPeriod}"
                                      Width="110"
                                      VerticalAlignment="Center"
                                      AutomationProperties.Name="History Period Selection"
                                      AutomationProperties.HelpText="Select the time period to view historical data">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="vm:HistoryPeriodOption">
                                        <TextBlock Text="{Binding Label}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>

            <!-- SUMMARY STATISTICS ROW -->
            <Border Grid.Row="1" Classes="Card" Padding="16" Margin="0,20,0,0"
                    IsVisible="{Binding HasData}">
                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16,12" Margin="4" MinWidth="140">
                        <StackPanel HorizontalAlignment="Center" Spacing="6">
                            <TextBlock Text="DOWNLOADED" Classes="MetricLabel" HorizontalAlignment="Center" />
                            <TextBlock Text="{Binding TotalDownload}"
                                       FontSize="20" FontWeight="Bold"
                                       Foreground="{DynamicResource DownloadBrush}"
                                       HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                    <Border Background="{DynamicResource BorderSubtleBrush}" CornerRadius="12" Padding="16,12" Margin="4" MinWidth="140">
                        <StackPanel HorizontalAlignment="Center" Spacing="6">
                            <TextBlock Text="UPLOADED" Classes="MetricLabel" HorizontalAlignment="Center" />
                            <TextBlock Text="{Binding TotalUpload}"
                                       FontSize="20" FontWeight="Bold"
                                       Foreground="{DynamicResource UploadBrush}"
                                       HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </WrapPanel>
            </Border>

            <!-- USAGE CHART -->
            <Border Grid.Row="2" Classes="ElevatedCard" Margin="0,20,0,0" Height="220"
                    IsVisible="{Binding HasData}">
                <Grid RowDefinitions="Auto, *">
                    <TextBlock Text="Daily Usage" Classes="CardTitle" />
                    <lvc:CartesianChart Grid.Row="1"
                                        Series="{Binding UsageSeries}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        TooltipPosition="Top"
                                        Background="{DynamicResource CardBrush}"
                                        AutomationProperties.Name="Daily Usage Chart"
                                        AutomationProperties.HelpText="Bar chart showing daily download and upload totals" />
                </Grid>
            </Border>

            <!-- Daily Usage Table -->
            <Border Grid.Row="3" Classes="ElevatedCard" Margin="0,20,0,0">
                <Grid RowDefinitions="Auto, Auto, *">
                    <TextBlock Text="Daily Breakdown" Classes="SectionHeader" />
                    
                    <!-- Table Header -->
                    <Border Grid.Row="1"
                            Background="{DynamicResource BorderSubtleBrush}"
                            CornerRadius="8"
                            Padding="16,12"
                            Margin="0,16,0,0">
                        <Grid ColumnDefinitions="1.2*, *, *, *">
                            <TextBlock Text="DATE" Classes="MetricLabel" FontWeight="Bold" />
                            <TextBlock Grid.Column="1" Text="DOWNLOADED" Classes="MetricLabel" FontWeight="Bold" />
                            <TextBlock Grid.Column="2" Text="UPLOADED" Classes="MetricLabel" FontWeight="Bold" />
                            <TextBlock Grid.Column="3" Text="TOTAL" Classes="MetricLabel" FontWeight="Bold" />
                        </Grid>
                    </Border>
                    
                    <!-- Data List -->
                    <ScrollViewer Grid.Row="2" Margin="0,8,0,0" MaxHeight="400">
                        <ItemsControl ItemsSource="{Binding DailyUsages}"
                                      AutomationProperties.Name="Daily Usage Data"
                                      AutomationProperties.HelpText="List of daily network usage records">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:DailyUsageItem">
                                    <Border Padding="16,14" Margin="0,2">
                                        <Grid ColumnDefinitions="1.2*, *, *, *">
                                            <TextBlock Text="{Binding DateFormatted}"
                                                       FontSize="14" FontWeight="Bold" />
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding DownloadFormatted}"
                                                       FontSize="14"
                                                       Foreground="{DynamicResource DownloadBrush}" />
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding UploadFormatted}"
                                                       FontSize="14"
                                                       Foreground="{DynamicResource UploadBrush}" />
                                            <TextBlock Grid.Column="3"
                                                       Text="{Binding TotalFormatted}"
                                                       FontSize="14" FontWeight="Bold" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Empty State -->
                    <Border Grid.Row="2"
                            Background="{DynamicResource BorderSubtleBrush}"
                            CornerRadius="12"
                            Padding="40"
                            Margin="0,20"
                            IsVisible="{Binding !HasData}">
                        <StackPanel HorizontalAlignment="Center" Spacing="12">
                            <TextBlock Text="No history data yet"
                                       FontSize="18" FontWeight="Bold"
                                       HorizontalAlignment="Center" />
                            <TextBlock Text="Data will appear after monitoring runs for a while"
                                       Classes="Subtitle"
                                       HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
